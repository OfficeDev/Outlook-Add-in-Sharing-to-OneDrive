---
page_type: sample
products:
- office-outlook
- office-onedrive
- office-365
languages:
- javascript
extensions:
  contentType: samples
  technologies:
  - Add-ins
  createdDate: 3/24/2016 9:32:55 AM
---
# Надстройка Microsoft Outlook для предоставления общего доступа к файлам в OneDrive

Теперь пользователи могут делиться файлами, хранящимися в OneDrive, непосредственно из надстройки Outlook.
В этом примере показано, как использовать API JavaScript для Office и API OneDrive для создания надстройки Microsoft Outlook, которая показывает, у каких получателей электронной почты есть разрешение на просмотр ссылки на OneDrive в тексте сообщения.
Если у некоторых получателей такого разрешения нет, пользователь может предоставить его выбранным получателям.

С помощью API `общих папок` OneDrive можно программным способом получать разрешения для элемента с помощью ссылки на элемент. Предоставить URL-адрес получателям сообщения можно с помощью `action.invite` и API `общих папок`.


## Содержание

* [Предварительные требования](#prerequisites)
* [Настройка проекта](#configure-the-project)
* [Запуск проекта](#run-the-project)
* [Разбор кода](#understand-the-code)
* [Вопросы и комментарии](#questions-and-comments)
* [Дополнительные ресурсы](#additional-resources)

## Предварительные требования

Для этого примера требуются следующие компоненты:

* Visual Studio 2015. Если у вас нет Visual Studio 2015, вы можете бесплатно установить [Visual Studio Community 2015](http://aka.ms/vscommunity2015). 
* [Инструменты разработчика Microsoft Office для Visual Studio 2015](http://aka.ms/officedevtoolsforvs2015).
* [Инструменты разработчика Microsoft Office для Visual Studio 2015 (предварительная версия)](http://www.microsoft.com/en-us/download/details.aspx?id=49972). Обратите внимание, что необходимо установить как базовую, так и предварительную версию Инструментов разработчика Microsoft Office для Visual Studio 2015.
* Outlook 2016.
* Компьютер с Exchange и хотя бы одной учетной записью электронной почты или учетной записью Office 365. Если у вас нет какой-либо из этих учетных записей, вы можете [принять участие в программе для разработчиков Office 365 и получить бесплатную годовую подписку на Office 365](https://aka.ms/devprogramsignup).
* Личная учетная запись OneDrive. Отличается от учетной записи Exchange.
* Браузер Internet Explorer 9 или более поздней версии должен быть установлен, но может не использоваться по умолчанию. Для поддержки надстроек Office клиент Office, выступающий в роли ведущего приложения, использует компоненты браузера, которые входят в состав Internet Explorer 9 или более поздней версии.

Примечание. В настоящее время этот пример подходит только для службы OneDrive, которая используется на домашних компьютерах. 

## Настройка проекта

1. Получите маркер с сайта разработчика решений для OneDrive. Для этого откройте [страницу проверки подлинности OneDrive](https://dev.onedrive.com/auth/msa_oauth.htm) и выполните вход, а затем нажмите кнопку**Получение маркера**. Скопируйте маркер после текста _Проверка подлинности: носитель_, и сохраните его в текстовом файле. Этот маркер действителен в течение часа и предоставляет вам доступ на чтение и запись к файлам пользователя OneDrive, выполнившего вход. Вам нужно будет войти в свое личное хранилище OneDrive.
2. Откройте файл решения **OutlookAddinOneDriveSharing.sln** и вставьте маркер в файл `\app\authentication.config.js`, как показано ниже.
```
TOKEN = '<your_token>';
```
3. В **обозревателе решений** выберите проект **OutlookAddinOneDriveSharing**, а затем в окне **Свойства** измените элемент **Действие при запуске** на **Настольный клиент Office**.

4. Щелкните правой кнопкой мыши проект **OutlookAddinOneDriveSharing** и выберите команду **Назначить запускаемые проекты**.
5. Закройте классический клиент Outlook.

## Запуск проекта

Нажмите **F5**, чтобы запустить проект. Вам будет предложено ввести электронный адрес и пароль для запуска Outlook. Введите свой электронный адрес и пароль для _Exchange_. **Примечание.** Они могут отличаться от электронного адреса и пароля для личной учетной записи OneDrive. 

Когда запустится классический клиент Outlook, нажмите кнопку **Создать сообщение**, чтобы написать новое сообщение.

**Важно!** Если вам не было предложено установить сертификат разработки для IIS Express, последовательно выберите элементы **Панель управления** | **Программы и компоненты** и **IIS Express**. Щелкните правой кнопкой мыши и выберите **Восстановить**. Перезапустите Visual Studio и откройте файл OutlookAddinOneDriveSharing.sln.

В этом примере используются [команды надстроек](https://msdn.microsoft.com/EN-US/library/office/mt267547.aspx), поэтому для запуска надстройки нажмите кнопку на ленте, указанную ниже.

![Кнопка проверки доступа на ленте](/readme-images/commandbutton.PNG)

Отобразится область задач со списком получателей. Список разделен на две части. В одной из них указаны получатели с разрешением на просмотр ссылки, в другой — получатели без этого разрешения.
**Примечание.** Каждый раз, когда вы добавляете или удаляете получателей либо редактируете ссылку, нажимайте эту кнопку заново, чтобы обновить список. 

Чтобы получить ссылку на OneDrive, войдите в учетную запись OneDrive на сайте www.onedrive.com и выберите один из своих файлов. Скопируйте ссылку на этот файл и вставьте ее в текст сообщения.

## Разбор кода

* `app.js` В файле app.js создается глобальный объект получателей с помощью метода `Office.context.mail.item.getAsync` для считывания получателей сообщения. Ссылки считываются аналогичным образом с `Office.context.mail.item.body.getAsync`.
* `onedrive.share.service.js` — объект, позволяющий обрабатывать запросы для API OneDrive. Этот объект включает следующее:
    - Свойство для использования ссылок.
    - Метод для отправки запросов конечной точке API OneDrive и использования API предоставления общего доступа и разрешений.
    - Объект пользовательского интерфейса для отображения надстройки в области задач.
* `render.controller.js` — объект для управления отображением в области задач. 

## Примечания

* В этом примере проверяется только первая ссылка в тексте сообщения.
* Чтобы получить токен, необходимо использовать личную учетную запись OneDrive.
* Если вы используете учетную запись Outlook в качестве личной учетной записи OneDrive и она еще не перенесена в Office 365, то общий доступ может не работать. Чтобы проверить, перенесена ли учетная запись, войдите в Outlook.com. Если в левом верхнем углу написано Outlook.com, то учетная запись не перенесена.

## Вопросы и комментарии

Мы будем рады получить ваши отзывы о примере *надстройки Outlook для предоставления общего доступа к файлам в OneDrive*.
Своими мыслями можете поделиться на вкладке *Проблемы* этого репозитория. Общие вопросы о разработке решений для Office 365 следует публиковать на сайте [Stack Overflow](http://stackoverflow.com/questions/tagged/Office365+API). Помечайте свои вопросы тегами [Office365] и [API].

## Дополнительные ресурсы

* [Документация по API-интерфейсам Office 365](http://msdn.microsoft.com/office/office365/howto/platform-development-overview)
* [Средства для интеграции API-интерфейсов Microsoft Office 365](https://visualstudiogallery.msdn.microsoft.com/a15b85e6-69a7-4fdf-adda-a38066bb5155)
* [Центр разработчиков Office](http://dev.office.com/)
* [Проекты API Office 365 и примеры кода для начинающих](http://msdn.microsoft.com/en-us/office/office365/howto/starter-projects-and-code-samples)
* [Центр по разработке для OneDrive](http://dev.onedrive.com)
* [Центр разработчика Outlook](http://dev.outlook.com)

## Авторские права
(c) Корпорация Майкрософт (Microsoft Corporation), 2016. Все права защищены.



Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [часто задаваемых вопросов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).
